<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator | Create Custom QR Codes with Logo & Gradients - Code Utils</title>
    <meta name="description" content="Professional QR code generator with logo upload, gradients, vector downloads (SVG/PDF). Create vCard, WiFi, Email, SMS QR codes. Customizable colors, patterns, shapes. 100% free & private. No registration required.">
    <meta name="keywords" content="qr code generator, qr code maker, custom qr code, qr code with logo, vcard qr code, wifi qr code, qr code svg, qr code pdf, gradient qr code">
    <link rel="canonical" href="https://codeutils.org/qr-generator">

    <!-- Favicon and Touch Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="theme-color" content="#3498db">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://codeutils.org/qr-generator">
    <meta property="og:title" content="Professional QR Code Generator - Custom QR Codes with Logo & Gradients">
    <meta property="og:description" content="Create professional QR codes with logo upload, gradients, and vector downloads. Support for vCard, WiFi, Email, SMS. Fully customizable colors, patterns, and shapes. 100% free.">
    <meta property="og:image" content="https://codeutils.org/images/og/qr-generator.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="QR Code Generator with Logo and Gradients - Free Professional Tool">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Professional QR Code Generator - Custom QR Codes with Logo & Gradients">
    <meta name="twitter:description" content="Create custom QR codes with logo upload, gradients, vector downloads (SVG/PDF). vCard, WiFi, Email, SMS support. 100% free & private.">
    <meta name="twitter:image" content="https://codeutils.org/images/og/qr-generator.png">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RPHPBJ4291"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-RPHPBJ4291');
    </script>

    <!-- Structured Data: WebApplication Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "QR Code Generator - Code Utils",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Professional QR code generator with logo upload, gradients, vector downloads (SVG/PDF/PNG). Create vCard, WiFi, Email, SMS QR codes. Customizable colors, patterns, shapes, and error correction. 100% free client-side processing.",
      "url": "https://codeutils.org/qr-generator",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "softwareVersion": "2.0",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.5",
        "ratingCount": "820"
      }
    }
    </script>

    <!-- Structured Data: FAQ Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What error correction levels are available for QR codes?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "QR codes support four error correction levels: L (7% recovery), M (15% recovery), Q (25% recovery), H (30% recovery). Higher levels can restore more data if the QR code is damaged, faded, or partially obscured, but require more space and are harder to scan. This tool uses Level M (15%) which balances data capacity with robustness for most applications. Choose L for clean, controlled environments. Choose H for outdoor or high-wear applications."
          }
        },
        {
          "@type": "Question",
          "name": "How much data can a QR code hold?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "QR code capacity depends on version and error correction level. Maximum capacity is ~4,296 alphanumeric characters for numeric data. URLs typically hold 2,000-3,000 characters depending on error correction. QR codes automatically scale to fit data (more data = larger code). Version 1 is smallest, Version 40 is largest (177x177 modules). This tool auto-scales based on content length."
          }
        },
        {
          "@type": "Question",
          "name": "What's the difference between different QR code versions?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "QR versions (1-40) determine physical size and data capacity. Version 1 is 21x21 modules minimum; Version 40 is 177x177 modules maximum. Higher versions hold more data but create larger codes. Version 1 holds ~41 bytes, Version 40 holds ~4,296 bytes. Scanning speed increases with Version. This tool auto-selects version based on content‚Äîyou don't need to manually choose."
          }
        },
        {
          "@type": "Question",
          "name": "Does QR code size matter for scanning?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Larger QR codes are easier to scan and more forgiving of damage or poor camera quality. Print at least 2cm x 2cm for reliable scanning. Very small codes (&lt;1cm) may fail with smartphone cameras. Screen display requires at least 100x100 pixels. This tool lets you choose sizes (128x128 to 512x512 pixels). Adjust based on usage‚Äîlarger for outdoor or distance scanning, smaller for tight spaces."
          }
        },
        {
          "@type": "Question",
          "name": "QR codes vs barcodes: what's the difference?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Barcodes (1D) store data in vertical lines and hold limited information (~20 characters). QR codes (2D) store data in a grid and hold vastly more information (4,000+ characters). QR codes work at angles while barcodes need to be straight. QR codes provide error correction; barcodes don't. QR codes are cheaper to produce and scan with smartphones. Use barcodes for simple product IDs; use QR codes for complex data, URLs, or WiFi credentials."
          }
        },
        {
          "@type": "Question",
          "name": "Can I customize QR code colors and styling?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This tool lets you customize foreground (code) and background colors. Keep high contrast for reliable scanning‚Äîavoid light colors on light backgrounds. Black on white is most reliable but any high-contrast combination works. Avoid patterns or gradients which confuse scanners. Never modify the timing patterns (alternating lines). Logo overlays should be minimal and placed carefully."
          }
        }
      ]
    }
    </script>

    <link rel="stylesheet" href="css/common.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <style>
        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-md);
        }
        .qr-display {
            background: white;
            padding: var(--spacing-md);
            border-radius: var(--radius);
            display: inline-block;
        }
        #qrcode {
            width: 256px;
            height: 256px;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            width: 100%;
        }
        .option-group {
            background: var(--bg-secondary);
            padding: var(--spacing-md);
            border-radius: var(--radius);
        }
        .option-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: bold;
        }
        .option-group input, .option-group select {
            width: 100%;
            padding: var(--spacing-xs);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        .qr-placeholder {
            width: 256px;
            height: 256px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            background: var(--bg-secondary);
        }
        .qr-placeholder.hidden {
            display: none;
        }
        #qrcode.hidden {
            display: none;
        }
        .editor-section {
            margin-bottom: var(--spacing-md);
        }
        .editor-section .options-grid {
            margin-bottom: var(--spacing-sm);
        }
        .editor-section .editor {
            width: 100%;
        }
        #logoSizeValue {
            display: inline-block;
            margin-left: var(--spacing-xs);
            font-weight: bold;
            min-width: 40px;
        }
        #logoSize {
            width: calc(100% - 50px);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="header-logo">
                <h1>Code Utils</h1>
            </a>
            <nav class="header-nav">
                <a href="index.html" class="btn btn-outline btn-sm">All Tools</a>
                <button class="theme-toggle" onclick="CodeUtils.Theme.toggle()">Toggle Dark Mode</button>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="card" style="margin-bottom: var(--spacing-md); padding: var(--spacing-md);">
            <h2 style="margin-bottom: var(--spacing-xs); color: var(--primary);">QR Code Generator</h2>
            <p style="margin: 0; color: var(--text-secondary);">Professional QR code generator with advanced customization. Create branded QR codes with logo upload, gradient colors, custom shapes (squares, dots, rounded), and adjustable error correction. Generate specialized QR codes for vCard contacts, WiFi networks, emails, and SMS messages. Download in multiple formats (PNG, SVG vector, PDF) for print and web. Customize every aspect: colors, gradients, module patterns, and sizes up to 2048px. Perfect for business cards, marketing materials, event tickets, WiFi sharing, and professional branding. All processing happens securely in your browser‚Äî100% private with no data uploaded to servers.</p>
        </div>

        <div class="options-grid">
            <div class="option-group" style="grid-column: 1 / -1;">
                <label>QR Code Type</label>
                <select id="qrType" onchange="toggleQRTypeInputs()" style="width: 100%;">
                    <option value="text">Text / URL</option>
                    <option value="vcard">vCard (Contact)</option>
                    <option value="wifi">WiFi Network</option>
                    <option value="email">Email</option>
                    <option value="sms">SMS</option>
                    <option value="phone">Phone / Call</option>
                    <option value="event">Event / Calendar</option>
                    <option value="location">Location / Maps</option>
                </select>
            </div>
        </div>

        <!-- Text/URL Input -->
        <div id="textInput" class="editor-section">
            <div class="editor-header">Content</div>
            <textarea id="contentInput" class="editor" style="height: 80px; resize: vertical;" placeholder="Enter text, URL, or data..." oninput="validateInput()">https://codeutils.org</textarea>
            <div id="validationStatus" style="margin-top: var(--spacing-xs); font-size: 0.875rem; display: flex; gap: var(--spacing-md); flex-wrap: wrap;"></div>
        </div>

        <!-- vCard Input -->
        <div id="vcardInput" class="editor-section" style="display: none;">
            <div class="editor-header">Contact Information</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Full Name *</label>
                    <input type="text" id="vcardName" placeholder="John Doe">
                </div>
                <div class="option-group">
                    <label>Phone</label>
                    <input type="tel" id="vcardPhone" placeholder="+1234567890">
                </div>
                <div class="option-group">
                    <label>Email</label>
                    <input type="email" id="vcardEmail" placeholder="john@example.com">
                </div>
                <div class="option-group">
                    <label>Organization</label>
                    <input type="text" id="vcardOrg" placeholder="Company Name">
                </div>
                <div class="option-group">
                    <label>Job Title</label>
                    <input type="text" id="vcardTitle" placeholder="CEO">
                </div>
                <div class="option-group">
                    <label>Website</label>
                    <input type="url" id="vcardUrl" placeholder="https://example.com">
                </div>
            </div>
        </div>

        <!-- WiFi Input -->
        <div id="wifiInput" class="editor-section" style="display: none;">
            <div class="editor-header">WiFi Network</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Network Name (SSID) *</label>
                    <input type="text" id="wifiSSID" placeholder="MyWiFi">
                </div>
                <div class="option-group">
                    <label>Password</label>
                    <input type="text" id="wifiPassword" placeholder="password123">
                </div>
                <div class="option-group">
                    <label>Encryption</label>
                    <select id="wifiEncryption">
                        <option value="WPA">WPA/WPA2</option>
                        <option value="WEP">WEP</option>
                        <option value="nopass">None (Open)</option>
                    </select>
                </div>
                <div class="option-group">
                    <label>Hidden Network</label>
                    <input type="checkbox" id="wifiHidden">
                </div>
            </div>
        </div>

        <!-- Email Input -->
        <div id="emailInput" class="editor-section" style="display: none;">
            <div class="editor-header">Email</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>To (Email Address) *</label>
                    <input type="email" id="emailTo" name="email" autocomplete="email" placeholder="recipient@example.com">
                </div>
                <div class="option-group">
                    <label>Subject</label>
                    <input type="text" id="emailSubject" name="subject" autocomplete="off" placeholder="Subject">
                </div>
            </div>
            <textarea id="emailBody" class="editor" style="height: 60px; margin-top: var(--spacing-sm); resize: vertical;" placeholder="Email body (optional)..."></textarea>
        </div>

        <!-- SMS Input -->
        <div id="smsInput" class="editor-section" style="display: none;">
            <div class="editor-header">SMS</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="smsPhone" placeholder="+1234567890">
                </div>
            </div>
            <textarea id="smsMessage" class="editor" style="height: 60px; margin-top: var(--spacing-sm); resize: vertical;" placeholder="Message text (optional)..."></textarea>
        </div>

        <!-- Phone Input -->
        <div id="phoneInput" class="editor-section" style="display: none;">
            <div class="editor-header">Phone / Call</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="phoneNumber" placeholder="+1234567890">
                </div>
            </div>
        </div>

        <!-- Event Input -->
        <div id="eventInput" class="editor-section" style="display: none;">
            <div class="editor-header">Event / Calendar</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Event Name *</label>
                    <input type="text" id="eventName" placeholder="Team Meeting">
                </div>
                <div class="option-group">
                    <label>Start Date/Time *</label>
                    <input type="datetime-local" id="eventStart">
                </div>
                <div class="option-group">
                    <label>End Date/Time</label>
                    <input type="datetime-local" id="eventEnd">
                </div>
                <div class="option-group">
                    <label>Location</label>
                    <input type="text" id="eventLocation" placeholder="Conference Room A">
                </div>
            </div>
            <textarea id="eventDescription" class="editor" style="height: 60px; margin-top: var(--spacing-sm); resize: vertical;" placeholder="Event description (optional)..."></textarea>
        </div>

        <!-- Location Input -->
        <div id="locationInput" class="editor-section" style="display: none;">
            <div class="editor-header">Location / Maps</div>
            <div class="options-grid">
                <div class="option-group">
                    <label>Latitude *</label>
                    <input type="number" id="locationLat" step="any" placeholder="37.7749">
                </div>
                <div class="option-group">
                    <label>Longitude *</label>
                    <input type="number" id="locationLng" step="any" placeholder="-122.4194">
                </div>
                <div class="option-group" style="grid-column: 1 / -1;">
                    <label>Or Address</label>
                    <input type="text" id="locationAddress" placeholder="123 Main St, City, State">
                    <small style="display: block; margin-top: 4px; color: var(--text-secondary);">Note: Address will be converted to Google Maps URL</small>
                </div>
            </div>
        </div>

        <div class="options-grid">
            <div class="option-group">
                <label>Size</label>
                <select id="sizeSelect">
                    <option value="128">128x128</option>
                    <option value="256" selected>256x256</option>
                    <option value="512">512x512</option>
                    <option value="1024">1024x1024</option>
                    <option value="2048">2048x2048</option>
                </select>
            </div>
            <div class="option-group">
                <label>Error Correction</label>
                <select id="errorCorrection" title="Higher levels recover more data if QR code is damaged">
                    <option value="L">L - Low (7%)</option>
                    <option value="M" selected>M - Medium (15%)</option>
                    <option value="Q">Q - Quartile (25%)</option>
                    <option value="H">H - High (30%)</option>
                </select>
            </div>
            <div class="option-group">
                <label>Color Type</label>
                <select id="colorType" onchange="toggleGradientControls()">
                    <option value="solid" selected>Solid Color</option>
                    <option value="linear">Linear Gradient</option>
                    <option value="radial">Radial Gradient</option>
                </select>
            </div>
            <div class="option-group">
                <label>Foreground</label>
                <input type="color" id="fgColor" value="#000000" onchange="checkContrast()">
            </div>
            <div class="option-group" id="fgColor2Group" style="display: none;">
                <label>Gradient Color 2</label>
                <input type="color" id="fgColor2" value="#3498db">
            </div>
            <div class="option-group">
                <label>Background</label>
                <input type="color" id="bgColor" value="#ffffff" onchange="checkContrast()">
            </div>
            <div class="option-group" style="grid-column: 1 / -1;">
                <div id="contrastIndicator" style="padding: var(--spacing-xs); border-radius: var(--radius); font-size: 0.875rem;"></div>
            </div>
            <div class="option-group">
                <label>Module Style</label>
                <select id="moduleStyle">
                    <option value="square" selected>Squares</option>
                    <option value="dots">Dots (Circles)</option>
                    <option value="rounded">Rounded Squares</option>
                </select>
            </div>
            <div class="option-group" style="grid-column: 1 / -1;">
                <label>Color Presets (Quick Apply)</label>
                <select id="colorPreset" onchange="applyColorPreset()">
                    <option value="">-- Select a Preset --</option>
                    <optgroup label="Professional">
                        <option value="classic">Classic Black & White</option>
                        <option value="navy">Navy Blue & White</option>
                        <option value="corporate">Corporate Blue & Gray</option>
                        <option value="elegant">Elegant Dark Gray & White</option>
                        <option value="professional">Professional Charcoal & Cream</option>
                    </optgroup>
                    <optgroup label="Vibrant">
                        <option value="sunset">Sunset Orange & Yellow</option>
                        <option value="ocean">Ocean Blue & Teal</option>
                        <option value="forest">Forest Green & Lime</option>
                        <option value="berry">Berry Purple & Pink</option>
                        <option value="fire">Fire Red & Orange</option>
                        <option value="neon">Neon Pink & Blue</option>
                    </optgroup>
                    <optgroup label="Pastel">
                        <option value="soft-pink">Soft Pink & White</option>
                        <option value="mint">Mint Green & Cream</option>
                        <option value="lavender">Lavender & Light Purple</option>
                        <option value="peach">Peach & Coral</option>
                        <option value="sky">Sky Blue & Light Blue</option>
                    </optgroup>
                    <optgroup label="High Contrast">
                        <option value="inverse">White on Black</option>
                        <option value="yellow-black">Yellow & Black</option>
                        <option value="cyan-dark">Cyan & Dark Blue</option>
                        <option value="lime-dark">Lime & Dark Green</option>
                        <option value="magenta-dark">Magenta & Dark Purple</option>
                    </optgroup>
                    <optgroup label="Brand Colors">
                        <option value="facebook">Facebook Blue</option>
                        <option value="instagram">Instagram Gradient</option>
                        <option value="twitter">Twitter Blue</option>
                        <option value="linkedin">LinkedIn Blue</option>
                        <option value="youtube">YouTube Red</option>
                    </optgroup>
                </select>
            </div>
        </div>

        <div class="options-grid">
            <div class="option-group">
                <label>Logo (Optional)</label>
                <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)">
            </div>
            <div class="option-group">
                <label>Logo Size (%)</label>
                <input type="range" id="logoSize" min="10" max="40" value="20" step="5">
                <span id="logoSizeValue">20%</span>
            </div>
            <div class="option-group">
                <button class="btn btn-secondary" onclick="clearLogo()" style="margin-top: 24px;">Clear Logo</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="generateQR()">Generate QR Code</button>
        </div>

        <div id="message" class="message"></div>

        <div class="qr-container">
            <div class="qr-display">
                <div id="qrPlaceholder" class="qr-placeholder">Click "Generate QR Code" to create</div>
                <canvas id="qrcode" class="hidden"></canvas>
            </div>
        </div>

        <div style="margin-top: var(--spacing-md); display: flex; gap: var(--spacing-sm); align-items: center; flex-wrap: wrap;">
            <label style="font-weight: bold;">Filename:</label>
            <input type="text" id="qrFilename" placeholder="qrcode" value="qrcode" style="flex: 1; min-width: 150px; padding: var(--spacing-xs); border: 1px solid var(--border); border-radius: var(--radius); background: var(--bg-primary); color: var(--text-primary);">
        </div>

        <div class="controls" style="margin-top: var(--spacing-sm);">
            <button class="btn" onclick="downloadQR()">Download PNG</button>
            <button class="btn" onclick="downloadSVG()">Download SVG</button>
            <button class="btn" onclick="downloadPDF()">Download PDF</button>
            <button class="btn" onclick="downloadAllFormats()" style="background: var(--primary); color: white;">üì¶ Download All (ZIP)</button>
            <button class="btn btn-secondary" onclick="copyQR()">Copy to Clipboard</button>
        </div>

        <div class="card" style="margin-top: var(--spacing-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h3 style="margin: 0;">Recent QR Codes</h3>
                <button class="btn btn-secondary btn-sm" onclick="clearHistory()" style="font-size: 0.875rem; padding: 0.25rem 0.75rem;">Clear All</button>
            </div>
            <div id="historyContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--spacing-md);">
                <p style="color: var(--text-secondary); text-align: center; grid-column: 1 / -1; margin: var(--spacing-md) 0;">No recent QR codes yet. Generate your first QR code to see it here!</p>
            </div>
        </div>

        <div class="related-tools">
            <h3>Related Tools</h3>
            <ul class="related-tools-list">
                <li><a href="base64-encoder.html">Base64 Encoder</a></li>
                <li><a href="url-encoder.html">URL Encoder</a></li>
                <li><a href="uuid-generator.html">UUID Generator</a></li>
            </ul>
        </div>

        <div class="info-section">
            <h2>About QR Code Generator</h2>
            <p>QR (Quick Response) codes are 2D barcodes that encode information in a visual pattern readable by smartphones and barcode scanners. Created in 1994, QR codes have become ubiquitous for marketing, product tracking, event management, and data sharing. This tool generates professional QR codes instantly with customization options and instant download capabilities. Perfect for businesses, marketers, developers, and anyone needing to share data through scannable codes.</p>

            <h3>Key Features</h3>
            <ul>
                <li><strong>Multiple QR Types:</strong> Text/URL, vCard (contacts), WiFi credentials, Email, SMS</li>
                <li><strong>Logo Upload:</strong> Add your brand logo to QR codes with adjustable size (10-40%)</li>
                <li><strong>Gradient Colors:</strong> Linear and radial gradients for eye-catching designs</li>
                <li><strong>Module Patterns:</strong> Choose from squares, dots, or rounded shapes</li>
                <li><strong>Vector Downloads:</strong> Export as SVG, PDF, or PNG for print and web</li>
                <li><strong>Flexible Sizes:</strong> Generate codes from 128x128 to 2048x2048 pixels</li>
                <li><strong>Error Correction:</strong> Choose Low (7%), Medium (15%), Quartile (25%), or High (30%)</li>
                <li><strong>Color Customization:</strong> Full control over foreground and background colors</li>
                <li><strong>Clipboard Copy:</strong> Copy QR code image directly to clipboard</li>
                <li><strong>WiFi QR Codes:</strong> Generate scannable WiFi credentials (WPA/WPA2/WEP/Open)</li>
                <li><strong>vCard QR Codes:</strong> Create digital business cards with contact info</li>
                <li><strong>100% Private:</strong> All processing happens in your browser‚Äîno data uploaded</li>
            </ul>

            <h3>How to Use This Tool</h3>

            <p><strong>Step 1: Enter Content</strong></p>
            <ol>
                <li>Paste or type the content you want to encode (URL, text, contact info, etc.)</li>
                <li>Content can be up to 4,296 characters</li>
            </ol>

            <p><strong>Step 2: Customize (Optional)</strong></p>
            <ol>
                <li>Choose QR code size (128x128, 256x256, or 512x512 pixels)</li>
                <li>Pick colors‚Äîclick color boxes to customize foreground and background</li>
                <li>Keep high contrast for reliable scanning</li>
            </ol>

            <p><strong>Step 3: Generate & Download</strong></p>
            <ol>
                <li>Click "Generate QR Code" to create your code</li>
                <li>Click "Download PNG" to save or "Copy to Clipboard" to use immediately</li>
            </ol>

            <p><em>Pro tip: Always test your QR code with a smartphone camera before distribution to ensure it scans properly.</em></p>

            <h3>Common Use Cases</h3>

            <p><strong>Marketing & Advertising Campaigns</strong></p>
            <p>Print QR codes on flyers, billboards, business cards, and packaging to direct customers to websites, promotional pages, or discount coupons. Track engagement by using unique QR codes for each campaign.</p>

            <p><strong>WiFi Network Sharing</strong></p>
            <p>Generate QR codes for WiFi credentials‚Äîguests can scan to connect instantly without typing passwords. Reduce support calls and improve user experience.</p>

            <p><strong>Event Management & Ticketing</strong></p>
            <p>Create QR codes for event tickets, attendee check-in, or registration links. Scannable codes speed up entry and improve security.</p>

            <p><strong>Product Tracking & Inventory</strong></p>
            <p>Encode product IDs, serial numbers, or tracking URLs in QR codes for supply chain management, inventory tracking, and authenticity verification.</p>

            <h3>Tips & Best Practices</h3>
            <ul>
                <li><strong>Maintain contrast:</strong> Use dark codes on light backgrounds or vice versa. Avoid similar colors</li>
                <li><strong>Size appropriately:</strong> Larger codes for distance viewing, smaller for close range. Minimum 2cm x 2cm for reliable scanning</li>
                <li><strong>Test before distribution:</strong> Scan with multiple devices to ensure functionality</li>
                <li><strong>Keep data concise:</strong> Shorter content = smaller, faster-scanning codes</li>
                <li><strong>Avoid overlays:</strong> Don't place logos or images over the timing patterns</li>
                <li><strong>Use HTTPS URLs:</strong> Direct to secure websites for maximum trust</li>
            </ul>

            <h3>Frequently Asked Questions</h3>

            <p><strong>Q: What error correction levels are available for QR codes?</strong></p>
            <p>A: QR codes support four error correction levels: L (7% recovery), M (15% recovery), Q (25% recovery), H (30% recovery). Higher levels can restore more data if the QR code is damaged, faded, or partially obscured, but require more space and are harder to scan. This tool uses Level M (15%) which balances data capacity with robustness for most applications. Choose L for clean, controlled environments. Choose H for outdoor or high-wear applications.</p>

            <p><strong>Q: How much data can a QR code hold?</strong></p>
            <p>A: QR code capacity depends on version and error correction level. Maximum capacity is ~4,296 alphanumeric characters for numeric data. URLs typically hold 2,000-3,000 characters depending on error correction. QR codes automatically scale to fit data (more data = larger code). Version 1 is smallest, Version 40 is largest (177x177 modules). This tool auto-scales based on content length.</p>

            <p><strong>Q: What's the difference between different QR code versions?</strong></p>
            <p>A: QR versions (1-40) determine physical size and data capacity. Version 1 is 21x21 modules minimum; Version 40 is 177x177 modules maximum. Higher versions hold more data but create larger codes. Version 1 holds ~41 bytes, Version 40 holds ~4,296 bytes. Scanning speed increases with Version. This tool auto-selects version based on content‚Äîyou don't need to manually choose.</p>

            <p><strong>Q: Does QR code size matter for scanning?</strong></p>
            <p>A: Larger QR codes are easier to scan and more forgiving of damage or poor camera quality. Print at least 2cm x 2cm for reliable scanning. Very small codes (<1cm) may fail with smartphone cameras. Screen display requires at least 100x100 pixels. This tool lets you choose sizes (128x128 to 512x512 pixels). Adjust based on usage‚Äîlarger for outdoor or distance scanning, smaller for tight spaces.</p>

            <p><strong>Q: QR codes vs barcodes: what's the difference?</strong></p>
            <p>A: Barcodes (1D) store data in vertical lines and hold limited information (~20 characters). QR codes (2D) store data in a grid and hold vastly more information (4,000+ characters). QR codes work at angles while barcodes need to be straight. QR codes provide error correction; barcodes don't. QR codes are cheaper to produce and scan with smartphones. Use barcodes for simple product IDs; use QR codes for complex data, URLs, or WiFi credentials.</p>

            <p><strong>Q: Can I customize QR code colors and styling?</strong></p>
            <p>A: This tool lets you customize foreground (code) and background colors. Keep high contrast for reliable scanning‚Äîavoid light colors on light backgrounds. Black on white is most reliable but any high-contrast combination works. Avoid patterns or gradients which confuse scanners. Never modify the timing patterns (alternating lines). Logo overlays should be minimal and placed carefully.</p>

            <h3>QR Code Technical Specifications</h3>
            <p>QR codes use Reed-Solomon error correction to recover damaged data. The format includes version info, format info, timing patterns, alignment patterns, and finder patterns (the three corner squares). The data area holds the encoded content. Higher error correction levels reserve more space for redundancy. All QR codes follow ISO/IEC 18004 standard ensuring universal compatibility with all modern scanners and smartphones.</p>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Code Utils. All rights reserved.</p>
        <p>Free developer utilities - 100% client-side processing</p>
    </footer>

    <script src="js/common.js"></script>
    <script>
        CodeUtils.RecentTools.add({
            id: 'qr-generator',
            name: 'QR Generator',
            url: 'qr-generator.html'
        });

        CodeUtils.Message.init('message');

        let qrGenerated = false;
        let currentQR = null;
        let currentSettings = {};
        let logoImage = null;

        // Update logo size display
        document.getElementById('logoSize').addEventListener('input', function(e) {
            document.getElementById('logoSizeValue').textContent = e.target.value + '%';
        });

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 2 * 1024 * 1024) {
                CodeUtils.Message.warning('Logo file should be under 2MB for best results');
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    logoImage = img;
                    CodeUtils.Message.success('Logo loaded! Click "Generate QR Code" to apply.');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function clearLogo() {
            logoImage = null;
            document.getElementById('logoUpload').value = '';
            CodeUtils.Message.success('Logo cleared');
        }

        // History Management
        const HISTORY_KEY = 'qr-generator-history';
        const MAX_HISTORY = 15;

        function saveToHistory(settings) {
            try {
                let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');

                // Add timestamp and preview
                settings.timestamp = Date.now();
                settings.preview = document.getElementById('qrcode').toDataURL('image/png');

                // Add to beginning of array
                history.unshift(settings);

                // Keep only last MAX_HISTORY items
                if (history.length > MAX_HISTORY) {
                    history = history.slice(0, MAX_HISTORY);
                }

                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                loadHistory();
            } catch (e) {
                console.error('Failed to save to history:', e);
            }
        }

        function loadHistory() {
            try {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                const container = document.getElementById('historyContainer');

                if (history.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; grid-column: 1 / -1; margin: var(--spacing-md) 0;">No recent QR codes yet. Generate your first QR code to see it here!</p>';
                    return;
                }

                container.innerHTML = history.map((item, index) => `
                    <div class="history-item" onclick="loadFromHistory(${index})" style="cursor: pointer; border: 1px solid var(--border); border-radius: var(--radius); padding: var(--spacing-sm); transition: all 0.2s;">
                        <img src="${item.preview}" alt="QR Code" style="width: 100%; height: auto; border-radius: var(--radius); margin-bottom: var(--spacing-xs);">
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">
                            <div style="font-weight: bold; color: var(--text-primary); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${getQRTypeLabel(item.qrType)}">${getQRTypeLabel(item.qrType)}</div>
                            <div>${new Date(item.timestamp).toLocaleDateString()}</div>
                        </div>
                    </div>
                `).join('');

                // Add hover effect via CSS
                const style = document.createElement('style');
                style.textContent = '.history-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }';
                if (!document.getElementById('history-styles')) {
                    style.id = 'history-styles';
                    document.head.appendChild(style);
                }
            } catch (e) {
                console.error('Failed to load history:', e);
            }
        }

        function getQRTypeLabel(type) {
            const labels = {
                'text': 'Text/URL',
                'vcard': 'vCard',
                'wifi': 'WiFi',
                'email': 'Email',
                'sms': 'SMS',
                'phone': 'Phone',
                'event': 'Event',
                'location': 'Location'
            };
            return labels[type] || 'QR Code';
        }

        function loadFromHistory(index) {
            try {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
                const item = history[index];
                if (!item) return;

                // Restore all settings
                document.getElementById('qrType').value = item.qrType || 'text';
                toggleQRTypeInputs();

                // Restore type-specific content
                if (item.qrType === 'text') {
                    document.getElementById('contentInput').value = item.content || '';
                }
                // Add other types as needed

                // Restore visual settings
                document.getElementById('sizeSelect').value = item.size || '256';
                document.getElementById('errorCorrection').value = item.errorCorrection || 'M';
                document.getElementById('colorType').value = item.colorType || 'solid';
                document.getElementById('fgColor').value = item.fgColor || '#000000';
                document.getElementById('fgColor2').value = item.fgColor2 || '#3498db';
                document.getElementById('bgColor').value = item.bgColor || '#ffffff';
                document.getElementById('moduleStyle').value = item.moduleStyle || 'square';

                toggleGradientControls();
                CodeUtils.Message.success('Settings loaded from history! Click "Generate QR Code" to recreate.');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (e) {
                console.error('Failed to load from history:', e);
                CodeUtils.Message.error('Failed to load settings from history');
            }
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all QR code history?')) {
                localStorage.removeItem(HISTORY_KEY);
                loadHistory();
                CodeUtils.Message.success('History cleared');
            }
        }

        // Load history on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            validateInput();
            checkContrast();
        });

        // Input Validation
        function validateInput() {
            const content = document.getElementById('contentInput').value;
            const statusDiv = document.getElementById('validationStatus');
            if (!statusDiv) return;

            const indicators = [];

            // Length indicator
            const length = content.length;
            const maxLength = 4296;
            const lengthPercent = (length / maxLength) * 100;
            let lengthColor = 'var(--success)';
            if (lengthPercent > 80) lengthColor = 'var(--warning)';
            if (lengthPercent > 95) lengthColor = 'var(--error)';

            indicators.push(`<span style="color: ${lengthColor};">üìè ${length}/${maxLength} characters (${lengthPercent.toFixed(1)}%)</span>`);

            // URL validation
            if (content.trim()) {
                try {
                    new URL(content.trim());
                    indicators.push('<span style="color: var(--success);">‚úì Valid URL</span>');
                } catch {
                    if (content.includes('http')) {
                        indicators.push('<span style="color: var(--warning);">‚ö† Invalid URL format</span>');
                    }
                }
            }

            // Scanning difficulty
            let difficulty = 'Easy';
            let difficultyColor = 'var(--success)';
            if (length > 1000) {
                difficulty = 'Medium';
                difficultyColor = 'var(--warning)';
            }
            if (length > 2500) {
                difficulty = 'Hard';
                difficultyColor = 'var(--error)';
            }
            indicators.push(`<span style="color: ${difficultyColor};">üì± Scan: ${difficulty}</span>`);

            statusDiv.innerHTML = indicators.join(' ');
        }

        function checkContrast() {
            const fgColor = document.getElementById('fgColor').value;
            const bgColor = document.getElementById('bgColor').value;
            const indicator = document.getElementById('contrastIndicator');
            if (!indicator) return;

            const ratio = getContrastRatio(fgColor, bgColor);

            let message, color, bgStyle;
            if (ratio >= 7) {
                message = `‚úì Excellent contrast (${ratio.toFixed(1)}:1) - Perfect for scanning`;
                color = 'var(--success)';
                bgStyle = 'rgba(34, 197, 94, 0.1)';
            } else if (ratio >= 4.5) {
                message = `‚úì Good contrast (${ratio.toFixed(1)}:1) - Suitable for most uses`;
                color = 'var(--success)';
                bgStyle = 'rgba(34, 197, 94, 0.1)';
            } else if (ratio >= 3) {
                message = `‚ö† Fair contrast (${ratio.toFixed(1)}:1) - May be difficult to scan`;
                color = 'var(--warning)';
                bgStyle = 'rgba(251, 146, 60, 0.1)';
            } else {
                message = `‚ùå Poor contrast (${ratio.toFixed(1)}:1) - QR code may not scan!`;
                color = 'var(--error)';
                bgStyle = 'rgba(239, 68, 68, 0.1)';
            }

            indicator.style.color = color;
            indicator.style.background = bgStyle;
            indicator.innerHTML = message;
        }

        function getContrastRatio(color1, color2) {
            const l1 = getLuminance(color1);
            const l2 = getLuminance(color2);
            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);
            return (lighter + 0.05) / (darker + 0.05);
        }

        function getLuminance(hex) {
            const rgb = hexToRgb(hex);
            const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(val => {
                val = val / 255;
                return val <= 0.03928 ? val / 12.92 : Math.pow((val + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        function toggleQRTypeInputs() {
            const qrType = document.getElementById('qrType').value;
            document.getElementById('textInput').style.display = qrType === 'text' ? 'block' : 'none';
            document.getElementById('vcardInput').style.display = qrType === 'vcard' ? 'block' : 'none';
            document.getElementById('wifiInput').style.display = qrType === 'wifi' ? 'block' : 'none';
            document.getElementById('emailInput').style.display = qrType === 'email' ? 'block' : 'none';
            document.getElementById('smsInput').style.display = qrType === 'sms' ? 'block' : 'none';
            document.getElementById('phoneInput').style.display = qrType === 'phone' ? 'block' : 'none';
            document.getElementById('eventInput').style.display = qrType === 'event' ? 'block' : 'none';
            document.getElementById('locationInput').style.display = qrType === 'location' ? 'block' : 'none';
        }

        function buildQRContent() {
            const qrType = document.getElementById('qrType').value;

            if (qrType === 'vcard') {
                const name = document.getElementById('vcardName').value.trim();
                const phone = document.getElementById('vcardPhone').value.trim();
                const email = document.getElementById('vcardEmail').value.trim();
                const org = document.getElementById('vcardOrg').value.trim();
                const title = document.getElementById('vcardTitle').value.trim();
                const url = document.getElementById('vcardUrl').value.trim();

                if (!name) {
                    CodeUtils.Message.error('Name is required for vCard');
                    return null;
                }

                let vcard = 'BEGIN:VCARD\nVERSION:3.0\n';
                vcard += `FN:${name}\n`;
                vcard += `N:${name};;;\n`;
                if (phone) vcard += `TEL:${phone}\n`;
                if (email) vcard += `EMAIL:${email}\n`;
                if (org) vcard += `ORG:${org}\n`;
                if (title) vcard += `TITLE:${title}\n`;
                if (url) vcard += `URL:${url}\n`;
                vcard += 'END:VCARD';
                return vcard;

            } else if (qrType === 'wifi') {
                const ssid = document.getElementById('wifiSSID').value.trim();
                const password = document.getElementById('wifiPassword').value.trim();
                const encryption = document.getElementById('wifiEncryption').value;
                const hidden = document.getElementById('wifiHidden').checked ? 'true' : 'false';

                if (!ssid) {
                    CodeUtils.Message.error('SSID is required for WiFi');
                    return null;
                }

                let wifi = `WIFI:T:${encryption};S:${ssid};`;
                if (password && encryption !== 'nopass') wifi += `P:${password};`;
                wifi += `H:${hidden};;`;
                return wifi;

            } else if (qrType === 'email') {
                const toEl = document.getElementById('emailTo');
                const subjectEl = document.getElementById('emailSubject');
                const bodyEl = document.getElementById('emailBody');

                if (!toEl || !subjectEl || !bodyEl) {
                    CodeUtils.Message.error('Email input fields not found');
                    return null;
                }

                const to = toEl.value.trim();
                const subject = subjectEl.value.trim();
                const body = bodyEl.value.trim();

                // Debug logging
                console.log('Email fields:', { to, subject, body });

                if (!to) {
                    CodeUtils.Message.error('Email address is required. Please enter an email address.');
                    return null;
                }

                let mailto = `mailto:${to}`;
                const params = [];
                if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
                if (body) params.push(`body=${encodeURIComponent(body)}`);
                if (params.length > 0) mailto += '?' + params.join('&');
                return mailto;

            } else if (qrType === 'sms') {
                const phoneEl = document.getElementById('smsPhone');
                const messageEl = document.getElementById('smsMessage');

                if (!phoneEl || !messageEl) {
                    CodeUtils.Message.error('SMS input fields not found');
                    return null;
                }

                const phone = phoneEl.value.trim();
                const message = messageEl.value.trim();

                if (!phone) {
                    CodeUtils.Message.error('Phone number is required for SMS');
                    return null;
                }

                let sms = `sms:${phone}`;
                if (message) sms += `?body=${encodeURIComponent(message)}`;
                return sms;

            } else if (qrType === 'phone') {
                const phoneEl = document.getElementById('phoneNumber');

                if (!phoneEl) {
                    CodeUtils.Message.error('Phone input field not found');
                    return null;
                }

                const phone = phoneEl.value.trim();

                if (!phone) {
                    CodeUtils.Message.error('Phone number is required');
                    return null;
                }

                return `tel:${phone}`;

            } else if (qrType === 'event') {
                const nameEl = document.getElementById('eventName');
                const startEl = document.getElementById('eventStart');
                const endEl = document.getElementById('eventEnd');
                const locationEl = document.getElementById('eventLocation');
                const descEl = document.getElementById('eventDescription');

                if (!nameEl || !startEl) {
                    CodeUtils.Message.error('Event input fields not found');
                    return null;
                }

                const name = nameEl.value.trim();
                const start = startEl.value;
                const end = endEl ? endEl.value : '';
                const location = locationEl ? locationEl.value.trim() : '';
                const description = descEl ? descEl.value.trim() : '';

                if (!name || !start) {
                    CodeUtils.Message.error('Event name and start date/time are required');
                    return null;
                }

                // Convert to iCal format
                const formatDateTime = (dt) => {
                    if (!dt) return '';
                    return new Date(dt).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                };

                let ical = 'BEGIN:VEVENT\n';
                ical += `SUMMARY:${name}\n`;
                ical += `DTSTART:${formatDateTime(start)}\n`;
                if (end) ical += `DTEND:${formatDateTime(end)}\n`;
                if (location) ical += `LOCATION:${location}\n`;
                if (description) ical += `DESCRIPTION:${description}\n`;
                ical += 'END:VEVENT';

                return ical;

            } else if (qrType === 'location') {
                const latEl = document.getElementById('locationLat');
                const lngEl = document.getElementById('locationLng');
                const addressEl = document.getElementById('locationAddress');

                if (!latEl || !lngEl || !addressEl) {
                    CodeUtils.Message.error('Location input fields not found');
                    return null;
                }

                const lat = latEl.value.trim();
                const lng = lngEl.value.trim();
                const address = addressEl.value.trim();

                if (lat && lng) {
                    // Use geo: protocol for coordinates
                    return `geo:${lat},${lng}`;
                } else if (address) {
                    // Use Google Maps URL for address
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`;
                } else {
                    CodeUtils.Message.error('Please enter either coordinates or an address');
                    return null;
                }

            } else {
                // Text/URL
                const contentEl = document.getElementById('contentInput');
                if (!contentEl) {
                    CodeUtils.Message.error('Content input field not found');
                    return null;
                }
                const content = contentEl.value.trim();
                if (!content) {
                    CodeUtils.Message.error('Please enter some content');
                    return null;
                }
                return content;
            }
        }

        function toggleGradientControls() {
            const colorType = document.getElementById('colorType').value;
            const fgColor2Group = document.getElementById('fgColor2Group');
            fgColor2Group.style.display = colorType !== 'solid' ? 'block' : 'none';
        }

        function applyColorPreset() {
            const preset = document.getElementById('colorPreset').value;
            if (!preset) return;

            const presets = {
                // Professional
                'classic': { fg: '#000000', fg2: '#000000', bg: '#ffffff', type: 'solid' },
                'navy': { fg: '#003366', fg2: '#003366', bg: '#ffffff', type: 'solid' },
                'corporate': { fg: '#2563eb', fg2: '#1e40af', bg: '#f3f4f6', type: 'linear' },
                'elegant': { fg: '#374151', fg2: '#374151', bg: '#ffffff', type: 'solid' },
                'professional': { fg: '#1f2937', fg2: '#1f2937', bg: '#f5f5dc', type: 'solid' },

                // Vibrant
                'sunset': { fg: '#ff6b35', fg2: '#f7931e', bg: '#ffffff', type: 'linear' },
                'ocean': { fg: '#0077be', fg2: '#00b4d8', bg: '#ffffff', type: 'linear' },
                'forest': { fg: '#2d6a4f', fg2: '#52b788', bg: '#ffffff', type: 'linear' },
                'berry': { fg: '#7209b7', fg2: '#f72585', bg: '#ffffff', type: 'linear' },
                'fire': { fg: '#dc2626', fg2: '#fb923c', bg: '#ffffff', type: 'linear' },
                'neon': { fg: '#ec4899', fg2: '#3b82f6', bg: '#000000', type: 'linear' },

                // Pastel
                'soft-pink': { fg: '#fbbf24', fg2: '#fb7185', bg: '#ffffff', type: 'linear' },
                'mint': { fg: '#6ee7b7', fg2: '#34d399', bg: '#fffbeb', type: 'linear' },
                'lavender': { fg: '#c084fc', fg2: '#e9d5ff', bg: '#ffffff', type: 'linear' },
                'peach': { fg: '#fdba74', fg2: '#fb923c', bg: '#ffffff', type: 'linear' },
                'sky': { fg: '#7dd3fc', fg2: '#38bdf8', bg: '#ffffff', type: 'linear' },

                // High Contrast
                'inverse': { fg: '#ffffff', fg2: '#ffffff', bg: '#000000', type: 'solid' },
                'yellow-black': { fg: '#fde047', fg2: '#fde047', bg: '#000000', type: 'solid' },
                'cyan-dark': { fg: '#22d3ee', fg2: '#06b6d4', bg: '#0c4a6e', type: 'linear' },
                'lime-dark': { fg: '#84cc16', fg2: '#65a30d', bg: '#14532d', type: 'linear' },
                'magenta-dark': { fg: '#e879f9', fg2: '#d946ef', bg: '#581c87', type: 'linear' },

                // Brand Colors
                'facebook': { fg: '#1877f2', fg2: '#1877f2', bg: '#ffffff', type: 'solid' },
                'instagram': { fg: '#e4405f', fg2: '#f77737', bg: '#ffffff', type: 'linear' },
                'twitter': { fg: '#1da1f2', fg2: '#1da1f2', bg: '#ffffff', type: 'solid' },
                'linkedin': { fg: '#0a66c2', fg2: '#0a66c2', bg: '#ffffff', type: 'solid' },
                'youtube': { fg: '#ff0000', fg2: '#ff0000', bg: '#ffffff', type: 'solid' }
            };

            const colors = presets[preset];
            if (colors) {
                document.getElementById('colorType').value = colors.type;
                document.getElementById('fgColor').value = colors.fg;
                document.getElementById('fgColor2').value = colors.fg2;
                document.getElementById('bgColor').value = colors.bg;
                toggleGradientControls();
                CodeUtils.Message.success('Color preset applied!');

                // Reset dropdown
                setTimeout(() => {
                    document.getElementById('colorPreset').value = '';
                }, 1000);
            }
        }

        function generateQR() {
            // Force focus/blur to trigger autofill recognition
            const qrType = document.getElementById('qrType').value;
            if (qrType === 'email') {
                const emailTo = document.getElementById('emailTo');
                if (emailTo) {
                    emailTo.focus();
                    emailTo.blur();
                }
            }

            // Delay to ensure autofilled values are available
            setTimeout(() => {
                const content = buildQRContent();
                if (!content) {
                    return; // Error message already shown in buildQRContent
                }

                const size = parseInt(document.getElementById('sizeSelect').value);
                const errorCorrectionLevel = document.getElementById('errorCorrection').value;
                const colorType = document.getElementById('colorType').value;
                const moduleStyle = document.getElementById('moduleStyle').value;
                const fgColor = document.getElementById('fgColor').value;
                const fgColor2 = document.getElementById('fgColor2').value;
                const bgColor = document.getElementById('bgColor').value;

            try {
                // Determine QR code type/version based on content length
                const typeNumber = content.length > 100 ? 0 : 4; // 0 = auto

                const qr = qrcode(typeNumber, errorCorrectionLevel);
                qr.addData(content);
                qr.make();

                // Store for exports
                currentQR = qr;
                const logoSizePercent = logoImage ? parseInt(document.getElementById('logoSize').value) : 0;
                currentSettings = {
                    size,
                    colorType,
                    moduleStyle,
                    fgColor,
                    fgColor2,
                    bgColor,
                    hasLogo: !!logoImage,
                    logoSizePercent
                };

                const canvas = document.getElementById('qrcode');
                const moduleCount = qr.getModuleCount();
                const cellSize = Math.floor(size / moduleCount);
                const actualSize = cellSize * moduleCount;

                canvas.width = actualSize;
                canvas.height = actualSize;

                const ctx = canvas.getContext('2d');

                // Fill background
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, actualSize, actualSize);

                // Create foreground gradient or solid color
                if (colorType === 'linear') {
                    const gradient = ctx.createLinearGradient(0, 0, actualSize, actualSize);
                    gradient.addColorStop(0, fgColor);
                    gradient.addColorStop(1, fgColor2);
                    ctx.fillStyle = gradient;
                } else if (colorType === 'radial') {
                    const centerX = actualSize / 2;
                    const centerY = actualSize / 2;
                    const radius = actualSize / 2;
                    const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                    gradient.addColorStop(0, fgColor);
                    gradient.addColorStop(1, fgColor2);
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = fgColor;
                }

                // Draw QR code modules with selected style
                for (let row = 0; row < moduleCount; row++) {
                    for (let col = 0; col < moduleCount; col++) {
                        if (qr.isDark(row, col)) {
                            const x = col * cellSize;
                            const y = row * cellSize;

                            if (moduleStyle === 'dots') {
                                // Draw circles
                                ctx.beginPath();
                                ctx.arc(x + cellSize / 2, y + cellSize / 2, cellSize / 2, 0, Math.PI * 2);
                                ctx.fill();
                            } else if (moduleStyle === 'rounded') {
                                // Draw rounded rectangles
                                const radius = cellSize * 0.3;
                                ctx.beginPath();
                                ctx.roundRect(x, y, cellSize, cellSize, radius);
                                ctx.fill();
                            } else {
                                // Draw squares (default)
                                ctx.fillRect(x, y, cellSize, cellSize);
                            }
                        }
                    }
                }

                // Draw logo overlay if present
                if (logoImage) {
                    const logoSizePercent = parseInt(document.getElementById('logoSize').value);
                    const logoSize = (actualSize * logoSizePercent) / 100;
                    const logoX = (actualSize - logoSize) / 2;
                    const logoY = (actualSize - logoSize) / 2;

                    // Draw white background circle for logo
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(actualSize / 2, actualSize / 2, logoSize / 2 + 5, 0, Math.PI * 2);
                    ctx.fill();

                    // Draw logo
                    ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
                }

                // Show canvas, hide placeholder
                document.getElementById('qrPlaceholder').classList.add('hidden');
                canvas.classList.remove('hidden');

                qrGenerated = true;
                CodeUtils.Message.success('QR code generated!');

                // Save to history
                saveToHistory({
                    qrType: document.getElementById('qrType').value,
                    content: content,
                    size: size,
                    errorCorrection: errorCorrectionLevel,
                    colorType: colorType,
                    moduleStyle: moduleStyle,
                    fgColor: fgColor,
                    fgColor2: fgColor2,
                    bgColor: bgColor
                });
            } catch (err) {
                CodeUtils.Message.error('Failed to generate QR code: ' + err.message);
            }
            }, 150); // 150ms delay to ensure autofilled values are available
        }

        function downloadQR() {
            if (!qrGenerated) {
                CodeUtils.Message.warning('Please generate a QR code first');
                return;
            }
            const filename = (document.getElementById('qrFilename').value.trim() || 'qrcode') + '.png';
            const canvas = document.getElementById('qrcode');
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
            CodeUtils.Message.success('PNG downloaded!');
        }

        function downloadSVG() {
            if (!qrGenerated || !currentQR) {
                CodeUtils.Message.warning('Please generate a QR code first');
                return;
            }

            const moduleCount = currentQR.getModuleCount();
            const cellSize = Math.floor(currentSettings.size / moduleCount);
            const actualSize = cellSize * moduleCount;

            // Create SVG with gradient definitions if needed
            let svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${actualSize}" height="${actualSize}" viewBox="0 0 ${actualSize} ${actualSize}">
    <defs>`;

            let fillAttribute = `fill="${currentSettings.fgColor}"`;

            if (currentSettings.colorType === 'linear') {
                svg += `
        <linearGradient id="qrGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:${currentSettings.fgColor};stop-opacity:1" />
            <stop offset="100%" style="stop-color:${currentSettings.fgColor2};stop-opacity:1" />
        </linearGradient>`;
                fillAttribute = 'fill="url(#qrGradient)"';
            } else if (currentSettings.colorType === 'radial') {
                svg += `
        <radialGradient id="qrGradient" cx="50%" cy="50%" r="50%">
            <stop offset="0%" style="stop-color:${currentSettings.fgColor};stop-opacity:1" />
            <stop offset="100%" style="stop-color:${currentSettings.fgColor2};stop-opacity:1" />
        </radialGradient>`;
                fillAttribute = 'fill="url(#qrGradient)"';
            }

            svg += `
    </defs>
    <rect width="${actualSize}" height="${actualSize}" fill="${currentSettings.bgColor}"/>
    <g ${fillAttribute}>`;

            // Draw QR modules with selected style
            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (currentQR.isDark(row, col)) {
                        const x = col * cellSize;
                        const y = row * cellSize;

                        if (currentSettings.moduleStyle === 'dots') {
                            const cx = x + cellSize / 2;
                            const cy = y + cellSize / 2;
                            const r = cellSize / 2;
                            svg += `
        <circle cx="${cx}" cy="${cy}" r="${r}"/>`;
                        } else if (currentSettings.moduleStyle === 'rounded') {
                            const radius = cellSize * 0.3;
                            svg += `
        <rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}" rx="${radius}" ry="${radius}"/>`;
                        } else {
                            svg += `
        <rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}"/>`;
                        }
                    }
                }
            }

            svg += `
    </g>`;

            // Add logo if present
            if (logoImage && currentSettings.hasLogo) {
                const logoSize = (actualSize * currentSettings.logoSizePercent) / 100;
                const logoX = (actualSize - logoSize) / 2;
                const logoY = (actualSize - logoSize) / 2;
                const radius = logoSize / 2 + 5;

                // Create canvas to convert logo to data URL
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = logoImage.width;
                tempCanvas.height = logoImage.height;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(logoImage, 0, 0);
                const logoDataURL = tempCanvas.toDataURL('image/png');

                svg += `
    <circle cx="${actualSize / 2}" cy="${actualSize / 2}" r="${radius}" fill="white"/>
    <image x="${logoX}" y="${logoY}" width="${logoSize}" height="${logoSize}" href="${logoDataURL}"/>`;
            }

            svg += `
</svg>`;

            // Download SVG
            const filename = (document.getElementById('qrFilename').value.trim() || 'qrcode') + '.svg';
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const link = document.createElement('a');
            link.download = filename;
            link.href = URL.createObjectURL(blob);
            link.click();
            URL.revokeObjectURL(link.href);
            CodeUtils.Message.success('SVG downloaded!');
        }

        function downloadPDF() {
            if (!qrGenerated) {
                CodeUtils.Message.warning('Please generate a QR code first');
                return;
            }

            const canvas = document.getElementById('qrcode');
            const imgData = canvas.toDataURL('image/png');

            // Create PDF using jsPDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // Calculate dimensions to fit QR code centered on page
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const qrSize = Math.min(pageWidth - 40, pageHeight - 40, 150); // Max 150mm
            const x = (pageWidth - qrSize) / 2;
            const y = (pageHeight - qrSize) / 2;

            pdf.addImage(imgData, 'PNG', x, y, qrSize, qrSize);
            const filename = (document.getElementById('qrFilename').value.trim() || 'qrcode') + '.pdf';
            pdf.save(filename);
            CodeUtils.Message.success('PDF downloaded!');
        }

        async function downloadAllFormats() {
            if (!qrGenerated || !currentQR) {
                CodeUtils.Message.warning('Please generate a QR code first');
                return;
            }

            try {
                const baseFilename = document.getElementById('qrFilename').value.trim() || 'qrcode';
                const zip = new JSZip();

                // Add PNG
                const canvas = document.getElementById('qrcode');
                const pngData = canvas.toDataURL('image/png').split(',')[1];
                zip.file(`${baseFilename}.png`, pngData, { base64: true });

                // Add SVG
                const svg = generateSVGContent();
                zip.file(`${baseFilename}.svg`, svg);

                // Add PDF
                const pdfBlob = await generatePDFBlob();
                zip.file(`${baseFilename}.pdf`, pdfBlob);

                // Generate and download ZIP
                const zipBlob = await zip.generateAsync({ type: 'blob' });
                const link = document.createElement('a');
                link.download = `${baseFilename}-qr-codes.zip`;
                link.href = URL.createObjectURL(zipBlob);
                link.click();
                URL.revokeObjectURL(link.href);

                CodeUtils.Message.success('All formats downloaded as ZIP!');
            } catch (error) {
                console.error('Batch download error:', error);
                CodeUtils.Message.error('Failed to create ZIP file');
            }
        }

        function generateSVGContent() {
            const moduleCount = currentQR.getModuleCount();
            const cellSize = Math.floor(currentSettings.size / moduleCount);
            const actualSize = cellSize * moduleCount;

            let svg = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${actualSize}" height="${actualSize}" viewBox="0 0 ${actualSize} ${actualSize}">
    <defs>`;

            let fillAttribute = `fill="${currentSettings.fgColor}"`;

            if (currentSettings.colorType === 'linear') {
                svg += `
        <linearGradient id="qrGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:${currentSettings.fgColor};stop-opacity:1" />
            <stop offset="100%" style="stop-color:${currentSettings.fgColor2};stop-opacity:1" />
        </linearGradient>`;
                fillAttribute = 'fill="url(#qrGradient)"';
            } else if (currentSettings.colorType === 'radial') {
                svg += `
        <radialGradient id="qrGradient" cx="50%" cy="50%" r="50%">
            <stop offset="0%" style="stop-color:${currentSettings.fgColor};stop-opacity:1" />
            <stop offset="100%" style="stop-color:${currentSettings.fgColor2};stop-opacity:1" />
        </radialGradient>`;
                fillAttribute = 'fill="url(#qrGradient)"';
            }

            svg += `
    </defs>
    <rect width="${actualSize}" height="${actualSize}" fill="${currentSettings.bgColor}"/>
    <g ${fillAttribute}>`;

            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (currentQR.isDark(row, col)) {
                        const x = col * cellSize;
                        const y = row * cellSize;

                        if (currentSettings.moduleStyle === 'dots') {
                            const cx = x + cellSize / 2;
                            const cy = y + cellSize / 2;
                            const r = cellSize / 2;
                            svg += `\n        <circle cx="${cx}" cy="${cy}" r="${r}"/>`;
                        } else if (currentSettings.moduleStyle === 'rounded') {
                            const radius = cellSize * 0.3;
                            svg += `\n        <rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}" rx="${radius}" ry="${radius}"/>`;
                        } else {
                            svg += `\n        <rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}"/>`;
                        }
                    }
                }
            }

            if (logoImage && currentSettings.hasLogo) {
                const logoSize = (actualSize * currentSettings.logoSizePercent) / 100;
                const logoX = (actualSize - logoSize) / 2;
                const logoY = (actualSize - logoSize) / 2;
                const radius = logoSize / 2 + 5;

                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = logoImage.width;
                tempCanvas.height = logoImage.height;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(logoImage, 0, 0);
                const logoDataURL = tempCanvas.toDataURL('image/png');

                svg += `\n    </g>\n    <circle cx="${actualSize / 2}" cy="${actualSize / 2}" r="${radius}" fill="white"/>`;
                svg += `\n    <image x="${logoX}" y="${logoY}" width="${logoSize}" height="${logoSize}" href="${logoDataURL}"/>`;
            } else {
                svg += `\n    </g>`;
            }

            svg += `\n</svg>`;
            return svg;
        }

        async function generatePDFBlob() {
            const canvas = document.getElementById('qrcode');
            const imgData = canvas.toDataURL('image/png');

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const qrSize = Math.min(pageWidth - 40, pageHeight - 40, 150);
            const x = (pageWidth - qrSize) / 2;
            const y = (pageHeight - qrSize) / 2;

            pdf.addImage(imgData, 'PNG', x, y, qrSize, qrSize);
            return pdf.output('blob');
        }

        async function copyQR() {
            if (!qrGenerated) {
                CodeUtils.Message.warning('Please generate a QR code first');
                return;
            }
            try {
                const canvas = document.getElementById('qrcode');
                canvas.toBlob(async (blob) => {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    CodeUtils.Message.success('QR code copied!');
                });
            } catch (err) {
                CodeUtils.Message.error('Failed to copy image');
            }
        }
    </script>
</body>
</html>
