<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CRITICAL: Apply theme immediately to prevent flash -->
    <script>
        (function() {
            const theme = localStorage.getItem('codeutils-theme');
            if (theme === 'light') {
                document.documentElement.classList.add('light-mode');
            }
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Formatter | Beautify & Minify JS - Code Utils</title>
    <meta name="description" content="Format, beautify, and minify JavaScript code with proper indentation instantly. Fix messy JS, compress files. 100% private client-side processing. Format now!">
    <meta name="keywords" content="javascript formatter, js beautifier, js minifier, format javascript, beautify js, minify js, javascript tool">
    <link rel="canonical" href="https://codeutils.org/js-formatter">

    <!-- Favicon and Touch Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="theme-color" content="#3498db">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://codeutils.org/js-formatter">
    <meta property="og:title" content="JavaScript Formatter - Code Utils">
    <meta property="og:description" content="Format, beautify, and minify JavaScript code with proper indentation. 100% private client-side processing.">
    <meta property="og:image" content="https://codeutils.org/images/og/js-formatter.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="JavaScript Formatter - Free online tool">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JavaScript Formatter - Code Utils">
    <meta name="twitter:description" content="Format and minify JavaScript instantly. Free tool with 100% private processing.">
    <meta name="twitter:image" content="https://codeutils.org/images/og/js-formatter.png">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">        <!-- Google Analytics (only load in production) -->
    <script>
        // Only load Google Analytics if NOT on localhost
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            // Load gtag.js
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-RPHPBJ4291';
            document.head.appendChild(script);

            // Initialize GA
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-RPHPBJ4291');
        } else {
            // Mock gtag function for localhost (prevents errors)
            window.gtag = function() {
                console.log('GA (localhost - not tracked):', arguments);
            };
        }
    </script>

    <!-- Structured Data: WebApplication Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "JavaScript Formatter - Code Utils",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Free JavaScript formatter and beautifier. Format, beautify, and minify JavaScript code with proper indentation. 100% client-side processing.",
      "url": "https://codeutils.org/js-formatter",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "softwareVersion": "1.0"
    }
    </script>
    <!-- Structured Data: FAQ Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Is my code safe when using this tool?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, absolutely! All JavaScript formatting happens entirely in your browser using JavaScript. Your code never leaves your computer and is never uploaded to any server. We don't store, log, or transmit your code in any way. This makes our tool completely safe for proprietary code, API keys, and sensitive business logic. You can even use this tool offline after the initial page load."
          }
        },
        {
          "@type": "Question",
          "name": "Can this tool format TypeScript or JSX code?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This formatter is optimized for standard JavaScript (ES5/ES6+). While basic TypeScript and JSX may format correctly, some TypeScript-specific syntax like type annotations and decorators may not format perfectly. For TypeScript files, use our dedicated TypeScript Formatter tool."
          }
        },
        {
          "@type": "Question",
          "name": "What's the difference between formatting and minifying?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Formatting (beautifying) adds proper indentation, line breaks, and spacing to make code human-readable. Minifying does the opposite—it removes all unnecessary whitespace and comments to reduce file size for production. Both operations preserve the functional behavior of your JavaScript; only the visual structure changes."
          }
        },
        {
          "@type": "Question",
          "name": "Do I need to create an account or sign up?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "No! All our tools are completely free and don't require any registration, sign-up, or account creation. Just visit the page and start using the JavaScript formatter immediately. There are no limits on usage, no premium tiers, and no hidden fees."
          }
        }
      ]
    }
    </script>
    <!-- Structured Data: HowTo Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Use JavaScript Formatter | Beautify & Minify JS Online",
      "description": "Step-by-step guide to using the free online JavaScript Formatter | Beautify & Minify JS tool at codeutils.org",
      "step": [
        {
          "@type": "HowToStep",
          "position": 1,
          "name": "Copy your JavaScript code from your editor, browser DevTo...",
          "text": "Copy your JavaScript code from your editor, browser DevTools, or API response"
        },
        {
          "@type": "HowToStep",
          "position": 2,
          "name": "Paste it into the input text area on the left side",
          "text": "Paste it into the input text area on the left side"
        },
        {
          "@type": "HowToStep",
          "position": 3,
          "name": "Click the \"Format\" button to beautify or \"Minify\" to comp...",
          "text": "Click the \"Format\" button to beautify or \"Minify\" to compact the code"
        },
        {
          "@type": "HowToStep",
          "position": 4,
          "name": "The formatted output appears instantly in the output area...",
          "text": "The formatted output appears instantly in the output area on the right"
        },
        {
          "@type": "HowToStep",
          "position": 5,
          "name": "Use the \"Copy\" button to copy the result to your clipboard",
          "text": "Use the \"Copy\" button to copy the result to your clipboard"
        }
      ]
    }
    </script>

    <link rel="stylesheet" href="css/common.css">
    <style>
        .options-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }
        .options-row label {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        .indent-select {
            padding: var(--spacing-xs);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="header-logo">
                <h1>Code Utils</h1>
            </a>
            <nav class="header-nav">
                <a href="index.html" class="btn btn-outline btn-sm">All Tools</a>
                <button class="theme-toggle" onclick="CodeUtils.Theme.toggle()">Toggle Dark Mode</button>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="card" style="margin-bottom: var(--spacing-md); padding: var(--spacing-md);">
            <h2 style="margin-bottom: var(--spacing-xs); color: var(--primary);">JavaScript Formatter</h2>
            <p style="margin: 0; color: var(--text-secondary);">Beautify and minify JavaScript code. All processing happens in your browser.</p>
        </div>

        <div class="drop-zone" id="dropZone">
            Drop JavaScript file here or click Upload File button
        </div>

        <div class="controls">
            <div class="controls-group">
                <button class="btn" onclick="formatJS()" title="Format JS (Ctrl+Enter)">Format</button>
                <button class="btn" onclick="minifyJS()" title="Minify JS (Ctrl+M)">Minify</button>
            </div>
            <div class="controls-group">
                <button class="btn btn-secondary" onclick="copyOutput()" title="Copy Output (Ctrl+K)">Copy</button>
                <label for="fileUpload" class="btn btn-secondary" style="margin: 0;">Upload</label>
                <input type="file" id="fileUpload" class="file-upload" accept=".js,.mjs,text/javascript,application/javascript">
                <button class="btn btn-secondary" onclick="downloadJS()">Download</button>
            </div>
            <button class="btn btn-outline" onclick="clearAll()">Clear</button>
        </div>

        <div class="options-row">
            <label>
                Indent:
                <select id="indentSelect" class="indent-select">
                    <option value="2">2 spaces</option>
                    <option value="4">4 spaces</option>
                    <option value="tab">Tab</option>
                </select>
            </label>
        </div>

        <div id="message" class="message"></div>

        <div class="editor-container">
            <div class="editor-section">
                <div class="editor-header">Input JavaScript</div>
                <textarea id="inputJS" class="editor" placeholder="Paste your JavaScript here..."></textarea>
            </div>
            <div class="editor-section">
                <div class="editor-header">Output</div>
                <textarea id="outputJS" class="editor" readonly placeholder="Formatted JavaScript will appear here..."></textarea>
            </div>
        </div>

        <!-- Related Tools -->
        <div class="related-tools">
            <h3>Related Tools</h3>
            <div class="related-tools-grid">
                <a href="json-formatter.html" class="related-tool-card">
                    <span class="related-tool-icon">{ }</span>
                    <span class="related-tool-name">JSON Formatter</span>
                </a>
                <a href="html-formatter.html" class="related-tool-card">
                    <span class="related-tool-icon"><></span>
                    <span class="related-tool-name">HTML Formatter</span>
                </a>
                <a href="css-formatter.html" class="related-tool-card">
                    <span class="related-tool-icon">CSS</span>
                    <span class="related-tool-name">CSS Formatter</span>
                </a>
                <a href="regex-tester.html" class="related-tool-card">
                    <span class="related-tool-icon">.*</span>
                    <span class="related-tool-name">Regex Tester</span>
                </a>
            </div>
        </div>

        <!-- Info Section -->
        <div class="info-section">
            <h2>About JavaScript Formatter</h2>
            <p>JavaScript code is often minified, obfuscated, or inconsistently formatted—making it difficult to read, debug, and maintain. Our JavaScript Formatter instantly beautifies any JavaScript code with proper indentation, line breaks, and spacing, transforming compact one-liners into clean, well-structured code. Whether you are inspecting third-party libraries, debugging production JS, or standardizing team code style, this tool handles it all. All processing happens entirely in your browser, ensuring your code remains private and never touches our servers.</p>

            <h3>Key Features</h3>
            <ul>
                <li><strong>Beautify JavaScript:</strong> Transform minified or compact JS into readable code with proper indentation and line breaks</li>
                <li><strong>Minify JavaScript:</strong> Remove all unnecessary whitespace, comments, and newlines to create compact JS for production use</li>
                <li><strong>Multiple Indentation Options:</strong> Choose between 2 spaces, 4 spaces, or tabs to match your coding style preferences</li>
                <li><strong>File Upload Support:</strong> Upload .js files directly from your computer or drag and drop them into the tool</li>
                <li><strong>One-Click Copy:</strong> Instantly copy the formatted output to your clipboard for use in your code editor</li>
                <li><strong>Download Output:</strong> Save the formatted or minified JavaScript as a .js file to your computer</li>
                <li><strong>Real-Time Processing:</strong> Instant formatting without page reloads or server round-trips</li>
                <li><strong>Privacy First:</strong> 100% client-side processing—your code never leaves your browser</li>
            </ul>

            <h3>How to Use This Tool</h3>

            <p><strong>Method 1: Paste JavaScript Code</strong></p>
            <ol>
                <li>Copy your JavaScript code from your editor, browser DevTools, or API response</li>
                <li>Paste it into the input text area on the left side</li>
                <li>Click the "Format" button to beautify or "Minify" to compact the code</li>
                <li>The formatted output appears instantly in the output area on the right</li>
                <li>Use the "Copy" button to copy the result to your clipboard</li>
            </ol>

            <p><strong>Method 2: Upload a JavaScript File</strong></p>
            <ol>
                <li>Click the "Upload" button or drag and drop your .js file into the designated area</li>
                <li>The file content will automatically load into the input area</li>
                <li>Format or minify as needed, then use the "Download" button to save the result</li>
            </ol>

            <h3>Common Use Cases</h3>

            <p><strong>Inspecting Minified Libraries</strong></p>
            <p>When debugging issues with third-party JavaScript libraries included via CDN, you often encounter minified code that is nearly impossible to read. Paste the minified code into this formatter to instantly transform it into readable JavaScript. This allows you to understand the library's behavior and identify where bugs might be occurring without needing access to the original source files.</p>

            <p><strong>Cleaning Up Legacy Code</strong></p>
            <p>Older codebases often contain inconsistently formatted JavaScript with mixed indentation styles and poor structure. Before doing a code review or refactoring, run the code through the formatter to normalize the style. This makes it much easier to spot logical issues, redundant code, and areas that need improvement without being distracted by formatting inconsistencies.</p>

            <p><strong>Minifying for Production Deployment</strong></p>
            <p>Before deploying JavaScript files to production, minifying them reduces file size and improves page load times. Remove all comments, extra whitespace, and unnecessary characters to create the smallest possible JS file. This is especially important for improving Google PageSpeed and Core Web Vitals scores.</p>

            <h3>Tips &amp; Best Practices</h3>
            <ul>
                <li><strong>Keep formatted versions for development:</strong> Always maintain the readable, formatted version of your code in your repository—only minify for production builds</li>
                <li><strong>Use consistent indentation:</strong> Pick either 2 spaces or 4 spaces and stick with it across your entire codebase for easier collaboration</li>
                <li><strong>Review after formatting:</strong> Use the formatted output as an opportunity to spot issues—deeply nested code and overly complex functions are easier to identify in formatted code</li>
                <li><strong>Check file size for large JS:</strong> Files under 2MB process instantly. Very large JavaScript files over 10MB may cause browser performance issues</li>
            </ul>

            <h3>Frequently Asked Questions</h3>

            <p><strong>Q: Is my code safe when using this tool?</strong></p>
            <p>A: Yes, absolutely! All JavaScript formatting happens entirely in your browser using JavaScript. Your code never leaves your computer and is never uploaded to any server. We don't store, log, or transmit your code in any way. This makes our tool completely safe for proprietary code, API keys, and sensitive business logic. You can even use this tool offline after the initial page load.</p>

            <p><strong>Q: Can this tool format TypeScript or JSX code?</strong></p>
            <p>A: This formatter is optimized for standard JavaScript (ES5/ES6+). While basic TypeScript and JSX may format correctly, some TypeScript-specific syntax like type annotations and decorators may not format perfectly. For TypeScript files, use our dedicated TypeScript Formatter tool.</p>

            <p><strong>Q: What's the difference between formatting and minifying?</strong></p>
            <p>A: Formatting (beautifying) adds proper indentation, line breaks, and spacing to make code human-readable. Minifying does the opposite—it removes all unnecessary whitespace and comments to reduce file size for production. Both operations preserve the functional behavior of your JavaScript; only the visual structure changes.</p>

            <p><strong>Q: Do I need to create an account or sign up?</strong></p>
            <p>A: No! All our tools are completely free and don't require any registration, sign-up, or account creation. Just visit the page and start using the JavaScript formatter immediately. There are no limits on usage, no premium tiers, and no hidden fees.</p>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Code Utils. All rights reserved.</p>
        <p>Free developer utilities - 100% client-side processing</p>
    </footer>

    <script src="js/common.js"></script>
    <script>
        // Track this tool visit
        CodeUtils.RecentTools.add({
            id: 'js-formatter',
            name: 'JavaScript Formatter',
            url: 'js-formatter.html'
        });

        // DOM elements
        const inputJS = document.getElementById('inputJS');
        const outputJS = document.getElementById('outputJS');
        const fileUpload = document.getElementById('fileUpload');
        const indentSelect = document.getElementById('indentSelect');

        // Initialize message handler
        CodeUtils.Message.init('message');

        // Initialize drag and drop
        CodeUtils.DragDrop.init('dropZone', async (file) => {
            const sizeCheck = CodeUtils.FileHandler.checkSize(file);
            if (sizeCheck.level === 'error') {
                CodeUtils.Message.error(sizeCheck.message);
                return;
            } else if (sizeCheck.level === 'warning') {
                CodeUtils.Message.warning(sizeCheck.message);
            }

            try {
                const content = await CodeUtils.FileHandler.readAsText(file);
                inputJS.value = content;
                CodeUtils.Message.success('File loaded successfully!');
            } catch (err) {
                CodeUtils.Message.error('Error reading file');
            }
        });

        // File upload handler
        fileUpload.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const sizeCheck = CodeUtils.FileHandler.checkSize(file);
            if (sizeCheck.level === 'error') {
                CodeUtils.Message.error(sizeCheck.message);
                return;
            } else if (sizeCheck.level === 'warning') {
                CodeUtils.Message.warning(sizeCheck.message);
            }

            try {
                const content = await CodeUtils.FileHandler.readAsText(file);
                inputJS.value = content;
                CodeUtils.Message.success('File loaded successfully!');
            } catch (err) {
                CodeUtils.Message.error('Error reading file');
            }
        });

        // Get indent string based on selection
        function getIndent() {
            const value = indentSelect.value;
            if (value === 'tab') return '\t';
            return ' '.repeat(parseInt(value));
        }

        // Format JavaScript
        function formatJS() {
            const input = inputJS.value.trim();
            if (!input) {
                CodeUtils.Message.error('Please enter some JavaScript to format');
                return;
            }

            try {
                const indent = getIndent();
                const formatted = beautifyJS(input, indent);
                outputJS.value = formatted;
                CodeUtils.Message.success('JavaScript formatted successfully!');
            } catch (error) {
                CodeUtils.Message.error('Error formatting JavaScript: ' + error.message);
                outputJS.value = '';
            }
        }

        // Beautify JavaScript
        function beautifyJS(code, indent) {
            let result = '';
            let level = 0;
            let i = 0;
            let inString = false;
            let stringChar = '';
            let inSingleComment = false;
            let inMultiComment = false;
            let inRegex = false;
            let inTemplateLiteral = false;
            let templateDepth = 0;

            // Keywords that should have newline after
            const blockKeywords = ['if', 'else', 'for', 'while', 'do', 'switch', 'try', 'catch', 'finally', 'function', 'class'];

            while (i < code.length) {
                const char = code[i];
                const nextChar = code[i + 1] || '';
                const prevChar = code[i - 1] || '';
                const prev2Char = code[i - 2] || '';

                // Handle single-line comments
                if (!inString && !inMultiComment && !inRegex && char === '/' && nextChar === '/') {
                    if (result.length > 0 && !result.endsWith('\n') && !result.endsWith(indent.repeat(level))) {
                        if (!result.endsWith(' ')) result += ' ';
                    }
                    result += '//';
                    i += 2;
                    inSingleComment = true;
                    continue;
                }

                if (inSingleComment) {
                    if (char === '\n') {
                        result += '\n' + indent.repeat(level);
                        inSingleComment = false;
                    } else {
                        result += char;
                    }
                    i++;
                    continue;
                }

                // Handle multi-line comments
                if (!inString && !inRegex && char === '/' && nextChar === '*') {
                    result += '/*';
                    i += 2;
                    inMultiComment = true;
                    continue;
                }

                if (inMultiComment) {
                    if (char === '*' && nextChar === '/') {
                        result += '*/';
                        i += 2;
                        inMultiComment = false;
                    } else {
                        result += char;
                        i++;
                    }
                    continue;
                }

                // Handle template literals
                if (!inString && !inRegex && char === '`') {
                    if (!inTemplateLiteral) {
                        inTemplateLiteral = true;
                        templateDepth = 0;
                    } else if (templateDepth === 0) {
                        inTemplateLiteral = false;
                    }
                    result += char;
                    i++;
                    continue;
                }

                if (inTemplateLiteral) {
                    if (char === '$' && nextChar === '{') {
                        templateDepth++;
                        result += '${';
                        i += 2;
                        continue;
                    }
                    if (char === '}' && templateDepth > 0) {
                        templateDepth--;
                    }
                    result += char;
                    i++;
                    continue;
                }

                // Handle strings
                if ((char === '"' || char === "'") && prevChar !== '\\') {
                    if (!inString) {
                        inString = true;
                        stringChar = char;
                    } else if (char === stringChar) {
                        inString = false;
                    }
                    result += char;
                    i++;
                    continue;
                }

                if (inString) {
                    result += char;
                    i++;
                    continue;
                }

                // Handle regex (basic detection)
                if (char === '/' && !inString && !inRegex) {
                    // Check if this is likely a regex
                    const trimmedResult = result.trimEnd();
                    const lastChar = trimmedResult[trimmedResult.length - 1];
                    if (lastChar && '=(:,;[!&|?{}'.includes(lastChar)) {
                        inRegex = true;
                        result += char;
                        i++;
                        continue;
                    }
                }

                if (inRegex) {
                    result += char;
                    if (char === '/' && prevChar !== '\\') {
                        // Skip flags
                        i++;
                        while (i < code.length && /[gimsuy]/.test(code[i])) {
                            result += code[i];
                            i++;
                        }
                        inRegex = false;
                        continue;
                    }
                    i++;
                    continue;
                }

                // Handle opening braces
                if (char === '{') {
                    result = result.trimEnd() + ' {\n';
                    level++;
                    result += indent.repeat(level);
                    i++;
                    continue;
                }

                // Handle closing braces
                if (char === '}') {
                    level = Math.max(0, level - 1);
                    result = result.trimEnd() + '\n' + indent.repeat(level) + '}';
                    i++;

                    // Check for else, catch, finally
                    let j = i;
                    while (j < code.length && /\s/.test(code[j])) j++;
                    const upcoming = code.substring(j, j + 10);
                    if (upcoming.startsWith('else') || upcoming.startsWith('catch') || upcoming.startsWith('finally')) {
                        result += ' ';
                    } else {
                        result += '\n';
                        if (level === 0) result += '\n';
                        result += indent.repeat(level);
                    }
                    continue;
                }

                // Handle opening brackets and parentheses
                if (char === '[' || char === '(') {
                    result += char;
                    i++;
                    continue;
                }

                // Handle closing brackets and parentheses
                if (char === ']' || char === ')') {
                    result += char;
                    i++;
                    continue;
                }

                // Handle semicolons
                if (char === ';') {
                    result = result.trimEnd() + ';\n' + indent.repeat(level);
                    i++;
                    // Skip whitespace after semicolon
                    while (i < code.length && /[ \t]/.test(code[i])) i++;
                    continue;
                }

                // Handle commas
                if (char === ',') {
                    result = result.trimEnd() + ', ';
                    i++;
                    // Skip whitespace after comma
                    while (i < code.length && /\s/.test(code[i])) i++;
                    continue;
                }

                // Handle colons (for objects, ternary)
                if (char === ':') {
                    result = result.trimEnd() + ': ';
                    i++;
                    while (i < code.length && /[ \t]/.test(code[i])) i++;
                    continue;
                }

                // Handle operators
                if ('=+-*/<>!&|?'.includes(char)) {
                    // Check for compound operators
                    const compound = char + nextChar;
                    const triple = compound + (code[i + 2] || '');

                    if (['===', '!==', '>>>'].includes(triple)) {
                        if (!result.endsWith(' ') && result.length > 0) result += ' ';
                        result += triple + ' ';
                        i += 3;
                        while (i < code.length && /[ \t]/.test(code[i])) i++;
                        continue;
                    }

                    if (['==', '!=', '>=', '<=', '&&', '||', '??', '=>', '+=', '-=', '*=', '/=', '++', '--', '<<', '>>'].includes(compound)) {
                        if (!result.endsWith(' ') && result.length > 0 && !['++', '--'].includes(compound)) result += ' ';
                        result += compound;
                        if (!['++', '--'].includes(compound)) result += ' ';
                        i += 2;
                        while (i < code.length && /[ \t]/.test(code[i])) i++;
                        continue;
                    }

                    // Single operators
                    if ('=<>+-*/!?'.includes(char)) {
                        if (!result.endsWith(' ') && result.length > 0) result += ' ';
                        result += char + ' ';
                        i++;
                        while (i < code.length && /[ \t]/.test(code[i])) i++;
                        continue;
                    }
                }

                // Handle whitespace
                if (/\s/.test(char)) {
                    if (result.length > 0 && !result.endsWith(' ') && !result.endsWith('\n') && !result.endsWith(indent)) {
                        result += ' ';
                    }
                    i++;
                    continue;
                }

                result += char;
                i++;
            }

            // Clean up result
            result = result.trim();
            // Remove multiple blank lines
            result = result.replace(/\n{3,}/g, '\n\n');
            // Remove trailing whitespace from lines
            result = result.split('\n').map(line => line.trimEnd()).join('\n');
            // Remove spaces before semicolons
            result = result.replace(/ +;/g, ';');
            // Fix spacing issues
            result = result.replace(/\( +/g, '(');
            result = result.replace(/ +\)/g, ')');
            result = result.replace(/\[ +/g, '[');
            result = result.replace(/ +\]/g, ']');

            return result;
        }

        // Minify JavaScript
        function minifyJS() {
            const input = inputJS.value.trim();
            if (!input) {
                CodeUtils.Message.error('Please enter some JavaScript to minify');
                return;
            }

            try {
                let minified = input;
                let result = '';
                let inString = false;
                let stringChar = '';
                let inSingleComment = false;
                let inMultiComment = false;
                let inRegex = false;
                let inTemplateLiteral = false;
                let templateDepth = 0;

                for (let i = 0; i < minified.length; i++) {
                    const char = minified[i];
                    const nextChar = minified[i + 1] || '';
                    const prevChar = minified[i - 1] || '';

                    // Handle single-line comments
                    if (!inString && !inMultiComment && !inRegex && char === '/' && nextChar === '/') {
                        inSingleComment = true;
                        i++;
                        continue;
                    }

                    if (inSingleComment) {
                        if (char === '\n') {
                            inSingleComment = false;
                            if (result.length > 0 && !/[;\{\}\(\)\[\],]$/.test(result.trim())) {
                                result += ';';
                            }
                        }
                        continue;
                    }

                    // Handle multi-line comments
                    if (!inString && !inRegex && char === '/' && nextChar === '*') {
                        inMultiComment = true;
                        i++;
                        continue;
                    }

                    if (inMultiComment) {
                        if (char === '*' && nextChar === '/') {
                            inMultiComment = false;
                            i++;
                        }
                        continue;
                    }

                    // Handle template literals
                    if (!inString && !inRegex && char === '`') {
                        if (!inTemplateLiteral) {
                            inTemplateLiteral = true;
                            templateDepth = 0;
                        } else if (templateDepth === 0) {
                            inTemplateLiteral = false;
                        }
                        result += char;
                        continue;
                    }

                    if (inTemplateLiteral) {
                        if (char === '$' && nextChar === '{') {
                            templateDepth++;
                        }
                        if (char === '}' && templateDepth > 0) {
                            templateDepth--;
                        }
                        result += char;
                        continue;
                    }

                    // Handle strings
                    if ((char === '"' || char === "'") && prevChar !== '\\') {
                        if (!inString) {
                            inString = true;
                            stringChar = char;
                        } else if (char === stringChar) {
                            inString = false;
                        }
                        result += char;
                        continue;
                    }

                    if (inString) {
                        result += char;
                        continue;
                    }

                    // Handle regex
                    if (char === '/' && !inRegex) {
                        const lastChar = result.trimEnd().slice(-1);
                        if (lastChar && '=(:,;[!&|?{}'.includes(lastChar)) {
                            inRegex = true;
                            result += char;
                            continue;
                        }
                    }

                    if (inRegex) {
                        result += char;
                        if (char === '/' && prevChar !== '\\') {
                            inRegex = false;
                        }
                        continue;
                    }

                    // Handle whitespace
                    if (/\s/.test(char)) {
                        const lastChar = result.slice(-1);
                        // Keep space between keywords/identifiers
                        if (/[a-zA-Z0-9_$]/.test(lastChar)) {
                            // Peek ahead to see if next non-whitespace is also alphanumeric
                            let j = i + 1;
                            while (j < minified.length && /\s/.test(minified[j])) j++;
                            if (j < minified.length && /[a-zA-Z0-9_$]/.test(minified[j])) {
                                result += ' ';
                            }
                        }
                        continue;
                    }

                    result += char;
                }

                outputJS.value = result;
                CodeUtils.Message.success('JavaScript minified successfully!');
            } catch (error) {
                CodeUtils.Message.error('Error minifying JavaScript: ' + error.message);
                outputJS.value = '';
            }
        }

        // Copy output
        async function copyOutput() {
            if (!outputJS.value) {
                CodeUtils.Message.error('Nothing to copy');
                return;
            }

            try {
                await CodeUtils.Clipboard.copy(outputJS.value);
                CodeUtils.Message.success('Copied to clipboard!');
            } catch (err) {
                CodeUtils.Message.error(err.message);
            }
        }

        // Download JavaScript
        function downloadJS() {
            if (!outputJS.value) {
                CodeUtils.Message.error('Nothing to download');
                return;
            }
            CodeUtils.FileHandler.download(outputJS.value, 'formatted.js', 'text/javascript');
            CodeUtils.Message.success('File downloaded!');
        }

        // Clear all
        function clearAll() {
            inputJS.value = '';
            outputJS.value = '';
            CodeUtils.Message.hide();
        }

        // Keyboard shortcuts
        CodeUtils.Shortcuts.register('Enter', formatJS, true);
        CodeUtils.Shortcuts.register('m', minifyJS, true);
        CodeUtils.Shortcuts.register('k', copyOutput, true);
    </script>
</body>
</html>
